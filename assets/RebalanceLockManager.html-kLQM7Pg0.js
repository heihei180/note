import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as t,d as o,o as r}from"./app-DJEiJ25B.js";const n={};function i(c,e){return r(),t("div",null,e[0]||(e[0]=[o('<h1 id="rebalancelockmanager" tabindex="-1"><a class="header-anchor" href="#rebalancelockmanager"><span>RebalanceLockManager</span></a></h1><p>重平衡的锁管理对象，在rocketMQ会进行锁的重平衡，内部通过<code>mqLockTable</code> 持有客户端以及messageQueue和ConsumerGroup的绑定关系</p><h2 id="什么是重平衡" tabindex="-1"><a class="header-anchor" href="#什么是重平衡"><span>什么是重平衡</span></a></h2><p>当一个新的消费者客户端添加进来的时候，就需要进行MessageQueue 与 consumerClient之间的绑定关系的重平衡。</p><figure><img src="https://gitee.com/gq2/img_repo2/raw/master/img/image-20240126221630296.png" alt="image-20240126221630296" tabindex="0" loading="lazy"><figcaption>image-20240126221630296</figcaption></figure><h2 id="绑定关系解释" tabindex="-1"><a class="header-anchor" href="#绑定关系解释"><span>绑定关系解释</span></a></h2><p>在rocketMQ中，为了提高性能，会将消息写到多个MessageQueue中，而消费者又从MessageQueue中拉取数据，每个MessageQueue最多绑定一个消费者客户端，因此，需要在内存中维护这样一份绑定关系。</p><ol><li>首先是通过消费者组来区分，因为在rocketMq中，每个消费者组是互相隔离的，意思就是他们之间的消费关系是不一样的。</li><li>第二就是一个消费者组下面可以有多个消息队列messageQueue对象，</li><li>第三就是一个消息队列messageQueue可以单独绑定一个消费者，这里以id作为唯一标志。</li></ol><h2 id="如何绑定" tabindex="-1"><a class="header-anchor" href="#如何绑定"><span>如何绑定</span></a></h2><ol><li>首先判断给定的messageQueue是否已经绑定了消费者客户端，如果绑定了消费者，那么这个queue就不会在去绑定新的消费者客户端，<strong>即一个queu只允许一个消费者来消费</strong>，这也是顺序消费的保证前提之一，单个queue的顺序性。</li><li>如果找到了有queue没有绑定消费者，那么就需要为这些queue绑定当前的客户端，以便于可以继续消费，下面解释如何进行绑定。 <ol><li>前提：对于没有绑定消费者的queue进行绑定，已经有消费者消费的queue不会在次绑定。</li><li>根据consumerGroup获取queue之间的绑定关系<code>ConcurrentHashMap&lt;MessageQueue, LockEntry&gt;</code>，根据数据结构看到是一对一的关系。</li><li>查找当前queue的锁对象lockEntity</li><li>为空的话，证明当前queue没有绑定消费者，需要创建锁对象，将消费者和queue之间的关系进行绑定。即构建map键值对。</li><li>为绑定关系对象<code>LockEntity</code> 设置绑定时间，为当前时间。</li></ol></li></ol><h2 id="如何解除绑定关系" tabindex="-1"><a class="header-anchor" href="#如何解除绑定关系"><span>如何解除绑定关系</span></a></h2><p>将上面绑定关系倒着来，</p><ol><li>先根据消费者组找到queue和客户端的绑定映射，</li><li>将映射接触，即将map中的key<code>queue</code> 移除，那么他们之间的绑定关系也就被删除了。</li></ol>',13)]))}const u=a(n,[["render",i]]),m=JSON.parse('{"path":"/Java/RocketMQ/brokerController%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/RebalanceLockManager.html","title":"RebalanceLockManager","lang":"zh-CN","frontmatter":{"description":"RebalanceLockManager 重平衡的锁管理对象，在rocketMQ会进行锁的重平衡，内部通过mqLockTable 持有客户端以及messageQueue和ConsumerGroup的绑定关系 什么是重平衡 当一个新的消费者客户端添加进来的时候，就需要进行MessageQueue 与 consumerClient之间的绑定关系的重平衡。 ...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"RebalanceLockManager\\",\\"image\\":[\\"https://gitee.com/gq2/img_repo2/raw/master/img/image-20240126221630296.png\\"],\\"dateModified\\":\\"2025-08-04T07:01:30.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"heihei180\\",\\"url\\":\\"https://github.com/heihei180\\"}]}"],["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/note/Java/RocketMQ/brokerController%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/RebalanceLockManager.html"}],["meta",{"property":"og:site_name","content":"筆記本首頁"}],["meta",{"property":"og:title","content":"RebalanceLockManager"}],["meta",{"property":"og:description","content":"RebalanceLockManager 重平衡的锁管理对象，在rocketMQ会进行锁的重平衡，内部通过mqLockTable 持有客户端以及messageQueue和ConsumerGroup的绑定关系 什么是重平衡 当一个新的消费者客户端添加进来的时候，就需要进行MessageQueue 与 consumerClient之间的绑定关系的重平衡。 ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://gitee.com/gq2/img_repo2/raw/master/img/image-20240126221630296.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-08-04T07:01:30.000Z"}],["meta",{"property":"article:modified_time","content":"2025-08-04T07:01:30.000Z"}]]},"git":{"createdTime":1754290890000,"updatedTime":1754290890000,"contributors":[{"name":"wanggq10","username":"wanggq10","email":"wanggq10@lenovo.com","commits":1,"url":"https://github.com/wanggq10"}]},"readingTime":{"minutes":2.06,"words":618},"filePathRelative":"Java/RocketMQ/brokerController组件介绍/RebalanceLockManager.md","autoDesc":true}');export{u as comp,m as data};
