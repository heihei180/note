import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,d as n,o as e}from"./app-B8f_IT3C.js";const t={};function l(h,s){return e(),a("div",null,s[0]||(s[0]=[n(`<h1 id="生产笔记" tabindex="-1"><a class="header-anchor" href="#生产笔记"><span>生产笔记</span></a></h1><blockquote><p>生产问题解决笔记</p></blockquote><p>因项目中不同服务互相调用，有时候遇见 spring 无法转换对象的问题，如果要查看原始的文本，还需要 将返回值设置成 Reponse 才能看，当然这种方式可以通过修改日志级别的方式解决<br> 还有一种情况：<br> feignInterceptor: 这里给请求头上添加了 accept-encoding = br,gzip</p><p>然后出现无法正常转码的情况，这种情况也是无法处理的，除非你添加返回值的解码对象，默认支持 gzip 和另一种叫啥，但是不支持br这种，需要自己添加解码器。</p><p>....</p><h2 id="处理办法" tabindex="-1"><a class="header-anchor" href="#处理办法"><span>处理办法</span></a></h2><p>直接再转换的地方打个断点，可以直接处理原始的流。</p><p>发送请求的组件： <code>SynchronousMethodHandler</code></p><p>逻辑</p><ul><li><p>入口：feign.SynchronousMethodHandler#invoke</p></li><li><p>发送请求： 执行发送请求和编码转换： feign.SynchronousMethodHandler#executeAndDecode</p></li></ul><p>所以，直接给这里打断点就可以</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-java"><span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> executeAndDecode</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">RequestTemplate</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> template</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Options</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> options) throws Throwable {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// 1. 获取request对象</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Request</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> request </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> targetRequest</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(template)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Response</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    long</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> start </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nanoTime</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    try</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	  // 执行http 请求</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">	  </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">      response </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> client</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">execute</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(request, options);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">	  </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	  // 再这里执行逻辑就行，可以查看返回值：StreamUtils.copyToString(response.body().asInputStream(), Charset.defaultCharset())</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">      response </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">toBuilder</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">          .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(request)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">          .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">requestTemplate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(template)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">          .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">build</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">IOException</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">      throw</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> errorExecuting</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> e)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    long</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> elapsedTime </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> TimeUnit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">NANOSECONDS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">toMillis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nanoTime</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> start);</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	// 解码</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> (decoder </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">      return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> decoder</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">decode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(response, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">metadata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">returnType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,12)]))}const r=i(t,[["render",l]]),d=JSON.parse('{"path":"/Java/Feign/%E7%94%9F%E4%BA%A7%E7%AC%94%E8%AE%B0.html","title":"生产笔记","lang":"zh-CN","frontmatter":{"description":"生产笔记 生产问题解决笔记 因项目中不同服务互相调用，有时候遇见 spring 无法转换对象的问题，如果要查看原始的文本，还需要 将返回值设置成 Reponse 才能看，当然这种方式可以通过修改日志级别的方式解决 还有一种情况： feignInterceptor: 这里给请求头上添加了 accept-encoding = br,gzip 然后出现无法正...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"生产笔记\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-08-27T09:59:51.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"heihei180\\",\\"url\\":\\"https://github.com/heihei180\\"}]}"],["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/note/Java/Feign/%E7%94%9F%E4%BA%A7%E7%AC%94%E8%AE%B0.html"}],["meta",{"property":"og:site_name","content":"筆記本首頁"}],["meta",{"property":"og:title","content":"生产笔记"}],["meta",{"property":"og:description","content":"生产笔记 生产问题解决笔记 因项目中不同服务互相调用，有时候遇见 spring 无法转换对象的问题，如果要查看原始的文本，还需要 将返回值设置成 Reponse 才能看，当然这种方式可以通过修改日志级别的方式解决 还有一种情况： feignInterceptor: 这里给请求头上添加了 accept-encoding = br,gzip 然后出现无法正..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-08-27T09:59:51.000Z"}],["meta",{"property":"article:modified_time","content":"2025-08-27T09:59:51.000Z"}]]},"git":{"createdTime":1756287992000,"updatedTime":1756288791000,"contributors":[{"name":"wanggq10","username":"wanggq10","email":"wanggq10@lenovo.com","commits":3,"url":"https://github.com/wanggq10"}]},"readingTime":{"minutes":1.09,"words":327},"filePathRelative":"Java/Feign/生产笔记.md","autoDesc":true}');export{r as comp,d as data};
