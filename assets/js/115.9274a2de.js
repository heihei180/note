(window.webpackJsonp=window.webpackJsonp||[]).push([[115],{620:function(t,s,a){"use strict";a.r(s);var n=a(27),r=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"libcurl-下载网络文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#libcurl-下载网络文件"}},[t._v("#")]),t._v(" libcurl 下载网络文件")]),t._v(" "),s("blockquote",[s("p",[t._v("使用 vcpkg 安装 libcurl")])]),t._v(" "),s("h1",{attrs:{id:"安装vkpkg"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装vkpkg"}},[t._v("#")]),t._v(" 安装vkpkg")]),t._v(" "),s("h2",{attrs:{id:"_1-download"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-download"}},[t._v("#")]),t._v(" 1. download")]),t._v(" "),s("p",[t._v("从GitHub上下载vcpkg工具，下载地址： "),s("code",[t._v("git clone https://github.com/Microsoft/vcpkg.git")])]),t._v(" "),s("p",[t._v("下载后，进入 "),s("code",[t._v("vcpkg")]),t._v(" 目录\n执行 "),s("code",[t._v("bootstrap-vcpkg.bat")]),t._v("\n会自动下载 vcpkg 程序")]),t._v(" "),s("h2",{attrs:{id:"_2-需要的话可以配置环境变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-需要的话可以配置环境变量"}},[t._v("#")]),t._v(" 2. 需要的话可以配置环境变量")]),t._v(" "),s("p",[t._v("vcpkg 是一个c/c++库管理工具，可以方便的安装各种库，比如libcurl")]),t._v(" "),s("h1",{attrs:{id:"_2-安装-libcurl"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装-libcurl"}},[t._v("#")]),t._v(" 2.安装 libcurl")]),t._v(" "),s("p",[t._v("https://blog.csdn.net/shhpeng/article/details/136006113")]),t._v(" "),s("p",[t._v("安装命令：\n"),s("code",[t._v("shell vcpkg.exe install curl:x64-windows")])]),t._v(" "),s("p",[t._v("成功截图：\n"),s("img",{attrs:{src:"https://i-blog.csdnimg.cn/direct/a2595c1c36ff44648758032870cbc985.png",alt:"libcurl的安装位置"}})]),t._v(" "),s("h1",{attrs:{id:"_3-vs2022-引用库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-vs2022-引用库"}},[t._v("#")]),t._v(" 3.vs2022 引用库")]),t._v(" "),s("p",[t._v("https://www.cnblogs.com/ligang0357/p/17188394.html")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://i-blog.csdnimg.cn/direct/505f472496414b29a56661ff10a43ca7.png",alt:"在这里插入图片描述"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://i-blog.csdnimg.cn/direct/5b62d31aa0b141bf9e24f334682f1b5a.png",alt:"在这里插入图片描述"}})]),t._v(" "),s("h1",{attrs:{id:"_4-使用库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-使用库"}},[t._v("#")]),t._v(" 4. 使用库")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[t._v("\n"),s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("<iostream>")]),t._v("  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("<curl/curl.h>")]),t._v("  ")]),t._v("\n\n\n\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 回调函数，用于接收下载的数据  ")]),t._v("\nsize_t "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("write_data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" ptr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" size_t size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" size_t nmemb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" FILE"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" stream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    size_t written "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fwrite")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ptr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nmemb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" stream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" written"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    CURL"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" curl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    FILE"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" fp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    CURLcode res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  \n\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_global_init")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CURL_GLOBAL_ALL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    curl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_easy_init")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("curl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 打开文件用于写入  ")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" code "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fopen_s")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("fp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"downloaded_file.mp4"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wb"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        std"),s("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("cout "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"open file result code"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" code "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),s("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("endl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置URL  ")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_easy_setopt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("curl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" CURLOPT_URL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://v3-default.365yg.com/d4f33a9ffe99ddd16160a1f9db76e3d1/66c59602/video/tos/cn/tos-cn-ve-4/owJAVf64fgCRDqoERI1EAiBDJAdFIuW7mRdcjJ/?a=0&ch=0&cr=0&dr=0&er=0&lr=unwatermarked&net=5&cd=0%7C0%7C0%7C0&cv=1&br=3804&bt=3804&cs=0&ds=4&eid=21760&ft=E3rg311Wv_SQ94iZxG0Id.xclfP8lciC~H3VWHrKsE&mime_type=video_mp4&qs=0&rc=PGg1ODVpNmY1Z2g0NzwzZkBpamtrOnQ5cnJ0czMzNDczM0AwNC41YjQyXjUxNGAuLjIyYSNecmBrMmRrYm9gLS1kLTBzcw%3D%3D&btag=c0000e00028000&dy_q=1724221201&feature_id=df0cd2e352f757347f92c05051e140af&l=20240821142001FC23A856EC1AD1009D39"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置回调函数和文件指针  ")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_easy_setopt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("curl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" CURLOPT_WRITEFUNCTION"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" write_data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_easy_setopt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("curl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" CURLOPT_WRITEDATA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 执行下载  ")]),t._v("\n        res "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_easy_perform")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("curl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 检查错误  ")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" CURLE_OK"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fprintf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("stderr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"curl_easy_perform() failed: %s\\n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_easy_strerror")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 清理  ")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_easy_cleanup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("curl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fclose")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl_global_cleanup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    std"),s("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("cout "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"file download complete"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" std"),s("span",{pre:!0,attrs:{class:"token double-colon punctuation"}},[t._v("::")]),t._v("endl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);