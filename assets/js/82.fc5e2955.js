(window.webpackJsonp=window.webpackJsonp||[]).push([[82],{587:function(t,a,s){"use strict";s.r(a);var n=s(27),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"_6-sw如何创建trace"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-sw如何创建trace"}},[t._v("#")]),t._v(" 6.sw如何创建trace？")]),t._v(" "),a("p",[t._v("sw的主要功能就说链路跟踪，那么如何创建trace呢？\n因为sw可以支持很多种的服务，包括同步线程，异步线程，MySQL，redis.")]),t._v(" "),a("p",[t._v("sw 是如何通过trace将不同的链路追踪，串联起来的呢？")]),t._v(" "),a("p",[t._v("这里通过http请求，来举例研究。")]),t._v(" "),a("h2",{attrs:{id:"_1-创建trace"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建trace"}},[t._v("#")]),t._v(" 1. 创建Trace")]),t._v(" "),a("h3",{attrs:{id:"_1-1-创建测试环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-创建测试环境"}},[t._v("#")]),t._v(" 1.1 创建测试环境")]),t._v(" "),a("p",[t._v("首先，我们需要创建一个测试环境，创建一个简单的spring mvc 的controller 用于提供Http服务")]),t._v(" "),a("p",[t._v("这个接口接收一个参数，将其存入redis，然后在从redis读取出来，返回给浏览器客户端。")]),t._v(" "),a("p",[t._v("那么可以考虑这个过程，有以下几个操作：")]),t._v(" "),a("ol",[a("li",[t._v("接收请求")]),t._v(" "),a("li",[t._v("存入redis")]),t._v(" "),a("li",[t._v("从redis读取")]),t._v(" "),a("li",[t._v("返回结果")])]),t._v(" "),a("h3",{attrs:{id:"_1-2-启动调试环境-断点来看。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-启动调试环境-断点来看。"}},[t._v("#")]),t._v(" 1.2 启动调试环境，断点来看。")]),t._v(" "),a("p",[t._v("D:\\code\\github\\sw-learn\n-javaagent:D:\\code\\github\\sw-learn\\skywalking-java\\skywalking-agent\\skywalking-agent.jar"),a("br"),t._v("\n-javaagent:D:/code/github/sw-learn/skywalking-java/skywalking-agent/skywalking-agent.jar")]),t._v(" "),a("p",[t._v("首先记得，重新compile以下 agent 的源码，因为如果你修改了的话，不重新compile的话，有些源码会对不上。\n"),a("code",[t._v("PS D:\\code\\github\\sw-learn\\skywalking-java> mvn clean install -DskipTests")]),t._v(" "),a("code",[t._v("./mvnw clean package -Pall")])]),t._v(" "),a("p",[t._v("或者说，如果源码调试的时候和代码匹配补上，那么手动选择一下源码，chosse source code， 将原来的 mvn lib 改成当前工程中 sw-java的源码目录。")]),t._v(" "),a("p",[t._v("将 sky walking的check Style 关闭，他不让写中文注释。")]),t._v(" "),a("p",[t._v("D:\\code\\github\\sw-learn\\skywalking-java\\pom.xml")]),t._v(" "),a("p",[t._v("将失败改成false")]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--        <checkstyle.fails.on.error>true</checkstyle.fails.on.error>--\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--        close check style plugin--\x3e")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("checkstyle.fails.on.error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("false"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("checkstyle.fails.on.error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" There are "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("102")]),t._v(" errors reported by Checkstyle "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9.3")]),t._v(" with D:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("github"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("sw-learn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("skywalking-java/apm-checkstyle/checkStyle.xml ruleset.\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ERROR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" src"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("skywalking"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("apm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("agent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("boot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("OverrideImplementor.java:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("regexp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" RegexpSingleline: Not allow chinese character "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ERROR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" src"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("skywalking"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("apm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("agent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("boot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("OverrideImplementor.java:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("31")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("regexp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" RegexpSingleline: Not allow chinese character "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ERROR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" src"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("skywalking"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("apm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("agent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("boot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("OverrideImplementor.java:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("regexp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" RegexpSingleline: Not allow chinese character "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ERROR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" src"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("skywalking"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("apm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("agent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("boot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("OverrideImplementor.java:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("33")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("regexp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" RegexpSingleline: Not allow chinese character "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ERROR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" src"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("skywalking"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("apm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("agent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("boot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("OverrideImplementor.java:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("35")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("regexp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" RegexpSingleline: Not allow chinese character "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ERROR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" src"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("skywalking"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("apm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("agent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("boot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("OverrideImplementor.java:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("36")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("regexp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" RegexpSingleline: Not allow chinese character "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n")])])]),a("h1",{attrs:{id:"redis-写数据拦截器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis-写数据拦截器"}},[t._v("#")]),t._v(" Redis 写数据拦截器")]),t._v(" "),a("p",[t._v("org.apache.skywalking.apm.plugin.lettuce.v5.RedisChannelWriterInterceptor")]),t._v(" "),a("h2",{attrs:{id:"创建span"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建span"}},[t._v("#")]),t._v(" 创建span")]),t._v(" "),a("p",[t._v("org.apache.skywalking.apm.agent.core.context.ContextManager#createExitSpan(java.lang.String, java.lang.String)")]),t._v(" "),a("h2",{attrs:{id:"springmvc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#springmvc"}},[t._v("#")]),t._v(" SpringMVC")]),t._v(" "),a("p",[t._v("org.apache.skywalking.apm.plugin.spring.mvc.commons.interceptor.AbstractMethodInterceptor")])])}),[],!1,null,null,null);a.default=e.exports}}]);