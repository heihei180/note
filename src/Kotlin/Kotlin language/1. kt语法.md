# Kt è¯­æ³•ç»Ÿè®¡


## inline

inline æ˜¯ Kotlin ä¸­çš„ä¸€ä¸ª**ç¼–è¯‘æœŸä¼˜åŒ–å…³é”®å­—ï¼Œç”¨äºå‡½æ•°å†…è”ï¼ˆinliningï¼‰**ã€‚å®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯ï¼š**åœ¨ç¼–è¯‘æ—¶å°†å‡½æ•°ä½“ç›´æ¥â€œå¤åˆ¶ç²˜è´´â€åˆ°è°ƒç”¨å¤„**ï¼Œè€Œä¸æ˜¯åƒæ™®é€šå‡½æ•°é‚£æ ·é€šè¿‡æ ‡å‡†çš„å‡½æ•°è°ƒç”¨æœºåˆ¶æ‰§è¡Œã€‚

```kt
private inline fun <R> withStopException(crossinline block: () -> R) {
    runCatching(block).onFailure {
        environment.log.error("Exception thrown during engine stop", it)
    }
}
```
è¿™é‡Œä½¿ç”¨ inline ä¸»è¦æ˜¯ä¸ºäº†**é«˜æ•ˆåœ°ä¼ é€’ lambda è¡¨è¾¾å¼ block**ï¼Œé¿å…åˆ›å»ºé¢å¤–çš„åŒ¿åç±»å¯¹è±¡ï¼ˆå°¤å…¶åœ¨é«˜é¢‘è°ƒç”¨æˆ–æ€§èƒ½æ•æ„Ÿåœºæ™¯ä¸‹ï¼‰ã€‚

### ğŸ” æ·±å…¥è§£é‡Š inline
### âœ… 1. ä¸ºä»€ä¹ˆéœ€è¦ inlineï¼Ÿ
Kotlin çš„é«˜é˜¶å‡½æ•°ï¼ˆæ¥æ”¶ lambda çš„å‡½æ•°ï¼‰åœ¨ JVM ä¸Šé»˜è®¤ä¼š**ç”ŸæˆåŒ¿åå†…éƒ¨ç±»**ï¼ˆFunction å¯¹è±¡ï¼‰ï¼Œä¾‹å¦‚ï¼š
```kt
// ä¸åŠ  inline
fun foo(action: () -> Unit) { action() }

foo { println("Hello") }
```
### âœ… 2. crossinline æ˜¯ä»€ä¹ˆï¼Ÿ
**ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ**
- inline å‡½æ•°é»˜è®¤å…è®¸ lambda ä¸­ä½¿ç”¨ éå±€éƒ¨è¿”å›ï¼ˆnon-local returnï¼‰ï¼Œå³ä» lambda ç›´æ¥è¿”å›å¤–å±‚å‡½æ•°
- ä½†ä½ çš„ block è¢«ä¼ ç»™äº† runCatchingï¼ˆä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œä¸æ˜¯ inline çš„ï¼‰ï¼Œè¿™æ„å‘³ç€ block ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯ç¨ååœ¨ runCatching å†…éƒ¨è°ƒç”¨ã€‚
- å¦‚æœå…è®¸éå±€éƒ¨è¿”å›ï¼Œä¼šå¯¼è‡´é€»è¾‘æ··ä¹±ç”šè‡³å´©æºƒã€‚

**crossinline çš„ä½œç”¨ï¼š**

> ç¦æ­¢åœ¨ block ä¸­ä½¿ç”¨éå±€éƒ¨è¿”å›ï¼ˆå¦‚ç›´æ¥å†™ returnï¼‰ï¼Œå¼ºåˆ¶ lambda åªèƒ½åšå±€éƒ¨è¿”å›ï¼ˆæ¯”å¦‚ return@label æˆ–æŠ›å¼‚å¸¸ï¼‰ã€‚
> âœ… è¿™ä¿è¯äº†æ§åˆ¶æµçš„å®‰å…¨æ€§ã€‚


### âœ… 4. ä»€ä¹ˆæ—¶å€™è¯¥ç”¨ inlineï¼Ÿ
| åœºæ™¯ | å»ºè®® |
|------|------|
| é«˜é˜¶å‡½æ•°ï¼ˆæ¥æ”¶ lambdaï¼‰ | âœ… ä¼˜å…ˆè€ƒè™‘ `inline`ï¼ˆå°¤å…¶æ˜¯å°å‡½æ•°ï¼‰ |
| lambda è¢«ç«‹å³æ‰§è¡Œ | âœ… é€‚åˆ inline |
| lambda è¢«ä¿å­˜/å¼‚æ­¥æ‰§è¡Œ | âš ï¸ å¿…é¡»åŠ  `crossinline`ï¼ˆå¦‚ä½ çš„ä¾‹å­ï¼‰ |
| å‡½æ•°ä½“å¾ˆå¤§æˆ–è°ƒç”¨é¢‘ç¹ | âš ï¸ è°¨æ…ï¼šinline ä¼šå¢å¤§å­—èŠ‚ç ä½“ç§¯ |
| æ™®é€šå‡½æ•°ï¼ˆæ—  lambdaï¼‰ | âŒ ä¸è¦ç”¨ inlineï¼ˆæ— æ”¶ç›Šï¼‰ |

> ğŸ’¡ ç»éªŒæ³•åˆ™ï¼šå·¥å…·å‹é«˜é˜¶å‡½æ•°ï¼ˆå¦‚ with, apply, run, also, runCatching å°è£…ç­‰ï¼‰é€šå¸¸ç”¨ inline





## by

```kt
internal val bootstraps: List<ServerBootstrap> by lazy {
    configuration.connectors.map(::createBootstrap)
}
```

ä½¿ç”¨äº† Kotlin çš„**å§”æ‰˜å±æ€§ï¼ˆDelegated Propertiesï¼‰** è¯­æ³•ï¼Œå…·ä½“æ˜¯** by lazy å§”æ‰˜**ï¼Œç”¨äºå®ç°**å»¶è¿Ÿåˆå§‹åŒ–ï¼ˆlazy initializationï¼‰**ã€‚


## by lazy { ... }
- è¿™æ˜¯ Kotlin çš„å±æ€§å§”æ‰˜ï¼ˆProperty Delegationï¼‰ è¯­æ³•ã€‚
- by lazy æ˜¯ Kotlin æ ‡å‡†åº“æä¾›çš„ä¸€ä¸ªå§”æ‰˜å®ç°ï¼Œç”¨äºæ‡’åŠ è½½ï¼šåªæœ‰ç¬¬ä¸€æ¬¡è®¿é—®è¯¥å±æ€§æ—¶ï¼Œæ‰æ‰§è¡Œå¤§æ‹¬å· {} ä¸­çš„ä»£ç å—ï¼›ä¹‹åçš„è®¿é—®ç›´æ¥è¿”å›ç¼“å­˜çš„ç»“æœã€‚
- é»˜è®¤æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ˆä½¿ç”¨ LazyThreadSafetyMode.SYNCHRONIZEDï¼‰ã€‚

### ğŸ§  è¡¥å……çŸ¥è¯†ï¼šby lazy çš„ç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| å»¶è¿Ÿè®¡ç®— | åˆå§‹åŒ–ä»£ç å—åªåœ¨é¦–æ¬¡è®¿é—®æ—¶æ‰§è¡Œ |
| çº¿ç¨‹å®‰å…¨ | é»˜è®¤åŠ é”ï¼Œå¤šçº¿ç¨‹ä¸‹åªåˆå§‹åŒ–ä¸€æ¬¡ |
| åªè¯»å±æ€§ | åªèƒ½ç”¨äº `val`ï¼Œä¸èƒ½ç”¨äº `var` |
| å¯é€‰æ¨¡å¼ | å¯æŒ‡å®šçº¿ç¨‹å®‰å…¨ç­–ç•¥ï¼š<br>`lazy(LazyThreadSafetyMode.NONE) { ... }`ï¼ˆéçº¿ç¨‹å®‰å…¨ï¼Œæ€§èƒ½æ›´é«˜ï¼‰ |

### ğŸ’¡ å¯¹æ¯” Java å†™æ³•ï¼ˆå¸®åŠ©ç†è§£ï¼‰
åœ¨ Java ä¸­ï¼Œè¦å®ç°ç±»ä¼¼æ•ˆæœï¼Œé€šå¸¸éœ€è¦æ‰‹åŠ¨å†™åŒé‡æ£€æŸ¥é”æˆ– synchronized æ–¹æ³•ï¼š
```java
private volatile List<ServerBootstrap> bootstraps;

public List<ServerBootstrap> getBootstraps() {
    if (bootstraps == null) {
        synchronized (this) {
            if (bootstraps == null) {
                bootstraps = configuration.getConnectors().stream()
                    .map(this::createBootstrap)
                    .collect(Collectors.toList());
            }
        }
    }
    return bootstraps;
}

```

## inflex
ä¸­ç¼€å‡½æ•°
