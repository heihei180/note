# 1. Actual / expect

ä½ çœ‹åˆ°çš„ actual å…³é”®å­—ï¼Œæ˜¯ Kotlin å¤šå¹³å°ï¼ˆKotlin Multiplatform, KMPï¼‰ ä¸­çš„æ ¸å¿ƒæœºåˆ¶ä¹‹ä¸€ã€‚å®ƒå’Œ expect æˆå¯¹å‡ºç°ï¼Œç”¨äºåœ¨ä¸åŒå¹³å°ï¼ˆJVMã€JSã€Native ç­‰ï¼‰ä¸Šæä¾›ä¸åŒçš„å®ç°ï¼ŒåŒæ—¶å…±äº«åŒä¸€å¥—æ¥å£ã€‚

**ğŸ” ä¸€å¥è¯è§£é‡Š actual**
> actual è¡¨ç¤ºâ€œè¿™æ˜¯æŸä¸ª expect å£°æ˜åœ¨å½“å‰å¹³å°ä¸Šçš„å…·ä½“å®ç°â€ã€‚


**ğŸ§± åŸºæœ¬åŸç†ï¼šexpect / actual å¯¹**

## 1. åœ¨ commonMainï¼ˆå…±äº«ä»£ç ï¼‰ä¸­å£°æ˜ expect

```kt
// commonMain
expect class EmbeddedServer<T, C>()

expect fun createServer(): EmbeddedServer<*, *>

```
è¿™é‡Œåªå£°æ˜â€œæœ‰è¿™ä¸ªç±»/å‡½æ•°â€ï¼Œä½†**ä¸æä¾›å®ç°**ã€‚

## 2. åœ¨ jvmMainã€jsMain ç­‰å¹³å°æ¨¡å—ä¸­æä¾› actual å®ç°
```kotlin
// jvmMain
actual class EmbeddedServer<T, C> {
    actual fun start(wait: Boolean) { /* JVM-specific code */ }
}

actual fun createServer(): EmbeddedServer<*, *> = EmbeddedServer()
```

âœ… è¿™å°±æ˜¯ä½ çœ‹åˆ°çš„ä»£ç æ‰€åœ¨çš„ä½ç½® â€”â€” **è¿™æ˜¯ Ktor åœ¨ JVM å¹³å°çš„å…·ä½“å®ç°**ã€‚

### â“ ä¸ºä»€ä¹ˆç±»ã€æ„é€ å™¨ã€å±æ€§ä¸Šéƒ½èƒ½åŠ  actualï¼Ÿ
å› ä¸º expect å¯ä»¥å£°æ˜ä»»ä½•ä¸œè¥¿ï¼Œæ‰€ä»¥ actual ä¹Ÿå¿…é¡»èƒ½å¯¹åº”å®ç°å®ƒä»¬ï¼š

| å£°æ˜ä½ç½® | `expect` ç¤ºä¾‹ | `actual` ç¤ºä¾‹ |
|--------|--------------|--------------|
| ç±» | `expect class Foo` | `actual class Foo` |
| æ„é€ å™¨ | `expect class Foo() { ... }` | `actual constructor(...)` |
| å±æ€§ | `expect val x: Int` | `actual val x: Int = 42` |
| å‡½æ•° | `expect fun hello()` | `actual fun hello() { ... }` |


> ğŸ’¡ æ³¨æ„ï¼šå¦‚æœ expect ç±»æœ‰ä¸»æ„é€ å™¨ï¼Œactual ç±»ä¹Ÿå¿…é¡»ç”¨ actual constructor(...) æ˜¾å¼å£°æ˜ã€‚

### ğŸ“Œ ä½ ä»£ç ä¸­çš„ actual è¯¦è§£

```kotlin
public actual class EmbeddedServer<...>  // â† è¿™ä¸ªç±»æ˜¯ common ä¸­ expect class çš„ JVM å®ç°
actual constructor(                      // â† ä¸»æ„é€ å™¨ä¹Ÿæ˜¯ actualï¼ˆå› ä¸º expect ç±»æœ‰æ„é€ å™¨ï¼‰
    private val rootConfig: ServerConfig,
    ...
) {
    public actual val monitor: Events = ...     // â† å±æ€§å®ç°
    public actual val environment: ApplicationEnvironment = ...
    public actual val application: Application  // â† å¸¦è‡ªå®šä¹‰ getter çš„å±æ€§
        get() = currentApplication()

    public actual fun start(wait: Boolean): EmbeddedServer<...> { ... } // â† å‡½æ•°å®ç°
}
```

### âœ… ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·è®¾è®¡ï¼Ÿï¼ˆä»¥ Ktor ä¸ºä¾‹ï¼‰
Ktor æ˜¯ä¸€ä¸ªå¤šå¹³å°æ¡†æ¶ï¼š
- åœ¨ JVM ä¸Šï¼Œç”¨ Netty/Jetty/Tomcat å¯åŠ¨æœåŠ¡å™¨
- åœ¨ Android (Native) ä¸Šï¼Œå¯èƒ½ç”¨ OkHttp æˆ–å…¶ä»–æ–¹å¼
- åœ¨ JS (Node.js) ä¸Šï¼Œç”¨ Node çš„ HTTP æ¨¡å—
ä½†ç”¨æˆ·å¸Œæœ›å†™åŒä¸€å¥— APIï¼š

```kotlin
embeddedServer(Netty, port = 8080) {
    routing { get("/") { ... } }
}.start()
```

â†’ æ‰€ä»¥ Ktor åœ¨ common ä¸­å®šä¹‰ expect class EmbeddedServerï¼Œ
â†’ ç„¶ååœ¨ JVM/JS/Native åˆ†åˆ«ç”¨ actual æä¾›å¹³å°ä¸“å±å®ç°ã€‚

### ğŸš« å¸¸è§è¯¯åŒº
| è¯¯åŒº | æ­£ç¡®ç†è§£ |
|------|--------|
| â€œ`actual` æ˜¯ä¿®é¥°ç¬¦ï¼Œåƒ `public`â€ | âŒ å®ƒæ˜¯å¤šå¹³å°å®ç°æ ‡è®°ï¼Œåªåœ¨æœ‰ `expect` æ—¶æ‰æœ‰æ„ä¹‰ |
| â€œæ²¡æœ‰ `expect` ä¹Ÿèƒ½ç”¨ `actual`â€ | âŒ ç¼–è¯‘ä¼šæŠ¥é”™ï¼šâ€œNo corresponding expected declarationâ€ |
| â€œ`actual` å¯ä»¥éšä¾¿åŠ â€ | âŒ å¿…é¡»å’Œ `expect` çš„ç­¾åå®Œå…¨åŒ¹é…ï¼ˆç±»å‹ã€æ³›å‹ã€å‚æ•°åç­‰ï¼‰ |



### ğŸ”§ å¦‚ä½•æŸ¥çœ‹å¯¹åº”çš„ expect å£°æ˜ï¼Ÿ

åœ¨ IntelliJ IDEA ä¸­ï¼š
- æŠŠå…‰æ ‡æ”¾åœ¨ actual class EmbeddedServer
- æŒ‰ Ctrl + Bï¼ˆGo to Declarationï¼‰
- IDE ä¼šè·³è½¬åˆ° commonMain ä¸­çš„ expect class EmbeddedServer

| å…³é”®ç‚¹ | è¯´æ˜ |
|-------|------|
| `actual` æ˜¯ä»€ä¹ˆï¼Ÿ | Kotlin å¤šå¹³å°ä¸­ï¼Œå¹³å°ç‰¹å®šå®ç°çš„æ ‡è®° |
| ä¸ºä»€ä¹ˆåˆ°å¤„éƒ½æœ‰ï¼Ÿ | å› ä¸º `expect` å£°æ˜äº†ç±»ã€æ„é€ å™¨ã€å±æ€§ã€å‡½æ•°ï¼Œæ‰€ä»¥ `actual` å¿…é¡»ä¸€ä¸€å¯¹åº”å®ç° |
| èƒ½ä¸èƒ½ä¸ç”¨ï¼Ÿ | å¦‚æœä½ åªå†™ JVM ä»£ç ï¼Œå¯ä»¥ä¸ç”¨ï¼›ä½†æ¡†æ¶ï¼ˆå¦‚ Ktorï¼‰å¿…é¡»ç”¨æ¥æ”¯æŒå¤šå¹³å° |
| å’Œæ™®é€š Kotlin ä»£ç åŒºåˆ«ï¼Ÿ | æ²¡æœ‰ `expect/actual` çš„é¡¹ç›®ï¼Œæ ¹æœ¬ä¸ä¼šå‡ºç° `actual` å…³é”®å­— |



> æ‰€ä»¥ä½ ä¹‹å‰æ²¡è§è¿‡ actualï¼Œå¾ˆå¯èƒ½æ˜¯å› ä¸ºä½ ä¸€ç›´åœ¨å†™çº¯ JVM å•å¹³å°é¡¹ç›®ã€‚ä¸€æ—¦æ¥è§¦ Ktorã€Compose Multiplatformã€KMM ç­‰å¤šå¹³å°åº“ï¼Œå°±ä¼šé¢‘ç¹è§åˆ°å®ƒã€‚

**è¿™å°±æ˜¯ Kotlin å®ç°â€œä¸€æ¬¡ç¼–å†™ï¼Œå¤šç«¯è¿è¡Œâ€çš„å…³é”®æœºåˆ¶ä¹‹ä¸€ ğŸ¯**
